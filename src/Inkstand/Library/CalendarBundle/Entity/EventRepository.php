<?php

namespace Inkstand\Library\CalendarBundle\Entity;

use Doctrine\DBAL\Types\Type;
use Doctrine\ORM\EntityRepository;
use Inkstand\Library\CalendarBundle\Model\EventInterface;

/**
 * EventRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class EventRepository extends EntityRepository
{
    public function create()
    {
        return new Event();
    }

    public function update(EventInterface $event)
    {
        $this->getEntityManager()->persist($event);
        $this->getEntityManager()->flush();
    }
    
    public function findEvents($calendarId, \DateTime $start, \DateTime $end)
    {
        $queryBuilder = $this->_em->createQueryBuilder();
        $queryBuilder->select('e')
            ->from('InkstandCalendarBundle:Event', 'e')
            ->where('e.calendarId = :calendarId')
            ->andWhere('e.start > :start')
            ->andWhere('e.start < :end')
            ->setParameter('calendarId', $calendarId)
            ->setParameter('start', $start, Type::DATETIME)
            ->setParameter('end', $end, Type::DATETIME);

        return $queryBuilder->getQuery()->getResult();
    }
}
